<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Home</title>
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quicksand">
</head>

<body class="container">
    <main>
        <section>
            <header>
                <h1 id="headerName"></h1>
            </header>
            <div id="ruffleContainer"></div>
            <footer>
                <p><select id="swfList"></select> Â© 2023 <a href="about.html">About</a></p>
            </footer> <!-- The heart of the whole site. This actually renders the SWF files. -->
        </section>
    </main>
    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script> <!-- Ruffle. Needed to run the SWF files. -->
    <script>
        fetch("./games.json")
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById("swfList");
                for (let key in data) {
                    const option = document.createElement("option");
                    option.textContent = data[key];
                    option.value = "./swf/" + data[key].toLowerCase().replace(/ /g, "_") + ".swf";
                    select.appendChild(option);
                } //Select tag builder. Will add entries based off the json file in the root.
                document.getElementById("swfList").onchange = function () {
                    localStorage.setItem("selectedSwf", document.getElementById("swfList").value);
                } //Select item saver. Basically saves a copy of the select tag"s items.
                const ruffleObject = window.RufflePlayer.newest();
                const ruffleElement = ruffleObject.createPlayer();
                document.querySelector("#ruffleContainer").appendChild(ruffleElement);
                if (localStorage.getItem("selectedSwf")) {
                    document.getElementById("swfList").value = localStorage.getItem("selectedSwf");
                    document.getElementById("headerName").textContent = document.getElementById("swfList").options[document.getElementById("swfList").selectedIndex].text;
                } //Select item loader. Simple but functional way to keep the last set value so that the games can actually switch properly.
                ruffleElement.load({ "url": document.getElementById("swfList").value, "quality": "best", "scale": "exactfit", "forceScale": true, "openUrlMode": "confirm" });
                ruffleElement.addEventListener("loadedmetadata", () => {
                    ruffleElement.style.width = ruffleElement.metadata.width + "px";
                    ruffleElement.style.height = ruffleElement.metadata.height + "px";
                })
                if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
                    document.querySelectorAll("#swfList option").forEach((e) => { e.addEventListener("touchstart", () => { window.location.reload() }) })
                } else {
                    document.querySelectorAll("#swfList option").forEach((e) => { e.addEventListener("mouseup", () => { window.location.reload() }) })
                } //Checks if you are using mobile or desktop and changes the event listener to the corresponding trigger.
            });
    </script>
</body>

</html>