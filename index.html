<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="description" content="A simple website to play free flash games on in the browser on any device.">
    <title>Home</title>
    <link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Quicksand">
</head>

<body>
    <main>
        <section class="container">
            <header>
                <h1 id="headerName"></h1>
            </header>
            <div id="ruffleContainer"></div>
            <footer>
                <p>Â© 2023 <a href="about.html">About</a></p>
            </footer> 
        </section>
    </main>
    <div class="scrollDiv", id="swfList"></div>
    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
    <script>
        fetch("https://raw.githubusercontent.com/flash-archive/flash-archive/main/index.json")
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById("swfList");
                for (let key in data) {
                    const button = document.createElement("button");
                    button.textContent = data[key];
                    button.value = "https://raw.githubusercontent.com/flash-archive/flash-archive/main/swf/" + data[key].toLowerCase().replace(/ /g, "_") + ".swf";
                    button.addEventListener("click", () => { 
                        localStorage.setItem("selectedSwfPath", button.value);
                        localStorage.setItem("selectedSwfName", button.textContent);
                        window.location.reload();
                     });
                    select.appendChild(button);
                }
                if (localStorage.getItem("selectedSwfPath")) {
                    document.getElementById("headerName").textContent = localStorage.getItem("selectedSwfName");
                    const ruffleObject = window.RufflePlayer.newest();
                    const ruffleElement = ruffleObject.createPlayer();
                    document.querySelector("#ruffleContainer").appendChild(ruffleElement);
                    ruffleElement.load({ "url": localStorage.getItem("selectedSwfPath"), "quality": "best", "scale": "exactfit", "forceScale": true, "openUrlMode": "confirm" });
                    ruffleElement.addEventListener("loadedmetadata", () => {
                    ruffleElement.style.width = ruffleElement.metadata.width + "px";
                    ruffleElement.style.height = ruffleElement.metadata.height + "px";
                })}
            });
    </script>
</body>

</html>